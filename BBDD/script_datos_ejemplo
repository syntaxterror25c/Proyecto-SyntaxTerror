-- 1. LIMPIEZA TOTAL
TRUNCATE reservas, sesiones, seleccion_actividad, suscripciones, 
         actividad_configurada, profesores, salas, tipo_actividad, 
         plan_precios, usuarios RESTART IDENTITY CASCADE;

-- 2. TABLAS MAESTRAS (Configuración mínima necesaria)
INSERT INTO tipo_actividad (nombre, descripcion) VALUES 
('Yoga', 'Flexibilidad'), 
('Zumba', 'Baile'), 
('Musculación', 'Pesas');

INSERT INTO plan_precios (nombre_plan, precio_mensual, limite_actividades) VALUES 
('Plan Básico', 30.00, 1), 
('Plan Dúo', 50.00, 2);

INSERT INTO salas (nombre, capacidad_maxima, tipo) VALUES 
('Sala Zen', 15, 'CLASES'), 
('Sala Principal', 30, 'CLASES');

INSERT INTO profesores (nombre, telefono, especialidad) VALUES 
('Roberto Sánchez', '600111222', 'Yoga'), 
('Marta López', '600333444', 'Zumba');

-- 3. USUARIOS (Con todos los campos obligatorios para evitar el error NULL)
INSERT INTO usuarios (nombre, email, password_hash, telefono) VALUES 
('Juan Pérez', 'juan.perez@email.com', '$2a$12$hash_simulado_juan', '699888777'),
('María García', 'maria.garcia@email.com', '$2a$12$hash_simulado_maria', '611222333');

-- 4. SUSCRIPCIONES
INSERT INTO suscripciones (id_usuario, id_plan, fecha_inicio, fecha_fin, estado) VALUES 
((SELECT id FROM usuarios WHERE email = 'juan.perez@email.com'), (SELECT id FROM plan_precios WHERE nombre_plan = 'Plan Dúo'), '2026-01-01', '2026-01-31', 'ACTIVA'),
((SELECT id FROM usuarios WHERE email = 'maria.garcia@email.com'), (SELECT id FROM plan_precios WHERE nombre_plan = 'Plan Básico'), '2026-01-01', '2026-01-31', 'ACTIVA');

-- 5. SELECCIÓN DE ACTIVIDADES
INSERT INTO seleccion_actividad (id_suscripcion, id_tipo_actividad) VALUES 
((SELECT s.id FROM suscripciones s JOIN usuarios u ON s.id_usuario = u.id WHERE u.email = 'juan.perez@email.com'), (SELECT id FROM tipo_actividad WHERE nombre = 'Yoga')),
((SELECT s.id FROM suscripciones s JOIN usuarios u ON s.id_usuario = u.id WHERE u.email = 'juan.perez@email.com'), (SELECT id FROM tipo_actividad WHERE nombre = 'Musculación')),
((SELECT s.id FROM suscripciones s JOIN usuarios u ON s.id_usuario = u.id WHERE u.email = 'maria.garcia@email.com'), (SELECT id FROM tipo_actividad WHERE nombre = 'Zumba'));

-- 6. MOLDES DE HORARIO
INSERT INTO actividad_configurada (nombre_clase, dia_semana, hora_inicio, duracion, id_tipo_actividad, id_sala, id_profesor_fijo) VALUES 
('Yoga Lunes', 1, '10:00:00', 60, (SELECT id FROM tipo_actividad WHERE nombre = 'Yoga'), (SELECT id FROM salas WHERE nombre = 'Sala Zen'), (SELECT id FROM profesores WHERE nombre = 'Roberto Sánchez')),
('Zumba Martes', 2, '19:00:00', 45, (SELECT id FROM tipo_actividad WHERE nombre = 'Zumba'), (SELECT id FROM salas WHERE nombre = 'Sala Principal'), (SELECT id FROM profesores WHERE nombre = 'Marta López'));

-- 7. SESIONES REALES
INSERT INTO sesiones (fecha, id_actividad_configurada) VALUES 
('2026-01-05', (SELECT id FROM actividad_configurada WHERE nombre_clase = 'Yoga Lunes')),
('2026-01-06', (SELECT id FROM actividad_configurada WHERE nombre_clase = 'Zumba Martes'));

-- 8. RESERVAS
INSERT INTO reservas (id_usuario, id_sesion, estado) VALUES 
((SELECT id FROM usuarios WHERE email = 'juan.perez@email.com'), (SELECT s.id FROM sesiones s JOIN actividad_configurada ac ON s.id_actividad_configurada = ac.id WHERE ac.nombre_clase = 'Yoga Lunes'), 'CONFIRMADA'),
((SELECT id FROM usuarios WHERE email = 'maria.garcia@email.com'), (SELECT s.id FROM sesiones s JOIN actividad_configurada ac ON s.id_actividad_configurada = ac.id WHERE ac.nombre_clase = 'Zumba Martes'), 'CONFIRMADA');
